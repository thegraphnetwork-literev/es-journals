upstream webapp {
    server literev:8000;
}

server {
	server_name 		staging.literev.com;

	listen       		80 			default_server;
	server_tokens off;

	location / {
		return 301 https://$host$request_uri;
	}

	location /.well-known/acme-challenge/ {
		allow all;
  		root /var/www/certbot;
	}
}



server {
    server_tokens off;

    charset utf-8;
    client_max_body_size 75M;
    client_body_buffer_size 75M;
    proxy_headers_hash_max_size 	1024;
	proxy_headers_hash_bucket_size 	128;

    listen		443 		ssl;
    http2 on;
    ssl_protocols TLSv1.2 TLSv1.3;

    location /static {
        autoindex on;
        alias /usr/share/nginx/html/literev/static;
    }

 	location / {
		proxy_pass 			http://webapp;
		proxy_set_header 	Host 		$http_host;
		proxy_set_header 	X-Real-IP 	$remote_addr;
		proxy_set_header 	X-Forwarded-For 	$proxy_add_x_forwarded_for;
		proxy_set_header 	X-Forwarded-Proto 	$scheme;
		proxy_set_header 	X-Forwarded-Proto 	https;
		proxy_set_header 	X-Forwarded-Port 	443;
		proxy_headers_hash_max_size 1024;
		proxy_headers_hash_bucket_size 128;
	}

    ssl_certificate         /etc/nginx/selfsigned-staging-fullchain.pem;
    ssl_certificate_key     /etc/nginx/selfsigned-staging-privkey.pem;

     if ($host = www.localhost) {
        return 301 https://localhost$request_uri;
    }
}
